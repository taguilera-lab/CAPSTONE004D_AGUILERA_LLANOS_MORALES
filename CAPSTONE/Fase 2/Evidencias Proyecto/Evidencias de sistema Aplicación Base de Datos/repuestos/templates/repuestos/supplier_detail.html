{% extends 'base.html' %}
{% load static %}

{% block title %}Proveedor: {{ supplier.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mb-0">
          <i class="fas fa-truck"></i> Proveedor: {{ supplier.name }}
        </h1>
        <div>
          <a href="{% url 'repuestos:supplier_update' supplier.pk %}" class="btn btn-primary me-2">
            <i class="fas fa-edit"></i> Editar
          </a>
          <a href="{% url 'repuestos:supplier_list' %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Volver
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Información del Proveedor -->
    <div class="col-lg-8">
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-info-circle"></i> Información del Proveedor
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <strong>Nombre:</strong>
                <span class="ms-2">{{ supplier.name }}</span>
              </div>

              {% if supplier.contact_person %}
              <div class="mb-3">
                <strong>Persona de Contacto:</strong>
                <span class="ms-2">{{ supplier.contact_person }}</span>
              </div>
              {% endif %}

              {% if supplier.phone %}
              <div class="mb-3">
                <strong>Teléfono:</strong>
                <span class="ms-2">
                  <a href="tel:{{ supplier.phone }}">{{ supplier.phone }}</a>
                </span>
              </div>
              {% endif %}

              {% if supplier.email %}
              <div class="mb-3">
                <strong>Email:</strong>
                <span class="ms-2">
                  <a href="mailto:{{ supplier.email }}">{{ supplier.email }}</a>
                </span>
              </div>
              {% endif %}
            </div>

            <div class="col-md-6">
              <div class="mb-3">
                <strong>Estado:</strong>
                <span class="ms-2">
                  {% if supplier.is_active %}
                  <span class="badge bg-success">Activo</span>
                  {% else %}
                  <span class="badge bg-secondary">Inactivo</span>
                  {% endif %}
                </span>
              </div>

              <div class="mb-3">
                <strong>Fecha de Creación:</strong>
                <span class="ms-2">{{ supplier.created_at|date:"d/m/Y H:i" }}</span>
              </div>

              <div class="mb-3">
                <strong>Última Actualización:</strong>
                <span class="ms-2">{{ supplier.updated_at|date:"d/m/Y H:i" }}</span>
              </div>
            </div>
          </div>

          {% if supplier.address %}
          <div class="mb-3">
            <strong>Dirección:</strong>
            <div class="mt-2 p-3 bg-light rounded">{{ supplier.address }}</div>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Órdenes de Compra Recientes -->
      {% if purchase_orders %}
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-shopping-cart"></i> Órdenes de Compra Recientes
          </h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Número de Orden</th>
                  <th>Fecha</th>
                  <th>Estado</th>
                  <th>Total</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                {% for order in purchase_orders %}
                <tr>
                  <td>{{ order.order_number }}</td>
                  <td>{{ order.created_at|date:"d/m/Y" }}</td>
                  <td>
                    {% if order.status == 'DRAFT' %}
                    <span class="badge bg-secondary">Borrador</span>
                    {% elif order.status == 'PENDING' %}
                    <span class="badge bg-warning">Pendiente</span>
                    {% elif order.status == 'APPROVED' %}
                    <span class="badge bg-success">Aprobada</span>
                    {% elif order.status == 'ORDERED' %}
                    <span class="badge bg-primary">Ordenada</span>
                    {% elif order.status == 'RECEIVED' %}
                    <span class="badge bg-info">Recibida</span>
                    {% elif order.status == 'CANCELLED' %}
                    <span class="badge bg-danger">Cancelada</span>
                    {% endif %}
                  </td>
                  <td>${{ order.total_amount|floatformat:0 }}</td>
                  <td>
                    <a href="{% url 'repuestos:purchase_order_detail' order.pk %}" class="btn btn-sm btn-outline-primary">
                      <i class="fas fa-eye"></i> Ver
                    </a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div class="text-center mt-3">
            <a href="{% url 'repuestos:purchase_order_list' %}?supplier={{ supplier.pk }}" class="btn btn-outline-primary">
              <i class="fas fa-list"></i> Ver Todas las Órdenes
            </a>
          </div>
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Estadísticas -->
    <div class="col-lg-4">
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-chart-bar"></i> Estadísticas
          </h5>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <strong>Órdenes de Compra:</strong>
            <span class="ms-2 badge bg-primary">{{ purchase_orders|length }}</span>
          </div>

          <div class="mb-3">
            <strong>Estado del Proveedor:</strong>
            <div class="mt-2">
              {% if supplier.is_active %}
              <span class="badge bg-success">Activo</span>
              {% else %}
              <span class="badge bg-secondary">Inactivo</span>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <!-- Acciones Rápidas -->
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-bolt"></i> Acciones Rápidas
          </h5>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <a href="{% url 'repuestos:purchase_order_create' %}" class="btn btn-success">
              <i class="fas fa-plus"></i> Nueva Orden de Compra
            </a>
            <a href="{% url 'repuestos:supplier_update' supplier.pk %}" class="btn btn-primary">
              <i class="fas fa-edit"></i> Editar Proveedor
            </a>
            <form method="post" action="{% url 'repuestos:supplier_delete' supplier.pk %}" class="d-grid" onsubmit="return confirm('¿Está seguro de eliminar este proveedor?')">
              {% csrf_token %}
              <button type="submit" class="btn btn-outline-danger">
                <i class="fas fa-trash"></i> Eliminar Proveedor
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}