{% extends 'base.html' %}
{% load static %}

{% block title %}Reportar Incidente - Chofer{% endblock %}

{% block static %}
<link rel="stylesheet" href="{% static 'incidents/css/chofer_report.css' %}">
<script src="{% static 'incidents/js/chofer_report.js' %}"></script>
{% endblock %}

{% block content %}
<div class="contenedor">
    <div class="formulario">
        <h2>Reportar Incidente (Chofer)</h2>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <!-- Información básica del incidente -->
            <div class="form-section">
                <h3>Información del Incidente</h3>
                <div class="form-row">
                    <div class="form-group">
                        {{ form.vehicle.label_tag }}
                        {{ form.vehicle }}
                        {% if form.vehicle.errors %}<div class="error">{{ form.vehicle.errors }}</div>{% endif %}
                    </div>
                    <div class="form-group">
                        {{ form.name.label_tag }}
                        {{ form.name }}
                        {% if form.name.errors %}<div class="error">{{ form.name.errors }}</div>{% endif %}
                    </div>
                </div>

                <div class="form-group">
                    {{ form.incident_type.label_tag }}
                    {{ form.incident_type }}
                    {% if form.incident_type.errors %}<div class="error">{{ form.incident_type.errors }}</div>{% endif %}
                </div>

                <div class="form-group">
                    {{ form.description.label_tag }}
                    {{ form.description }}
                    {% if form.description.errors %}<div class="error">{{ form.description.errors }}</div>{% endif %}
                </div>
            </div>

            <!-- Ubicación -->
            <div class="form-section">
                <h3>Ubicación</h3>
                <div class="form-group">
                    {{ form.location.label_tag }}
                    {{ form.location }}
                    {% if form.location.errors %}<div class="error">{{ form.location.errors }}</div>{% endif %}
                </div>

                <div class="form-row">
                    <div class="form-group">
                        {{ form.latitude.label_tag }}
                        {{ form.latitude }}
                        {% if form.latitude.errors %}<div class="error">{{ form.latitude.errors }}</div>{% endif %}
                    </div>
                    <div class="form-group">
                        {{ form.longitude.label_tag }}
                        {{ form.longitude }}
                        {% if form.longitude.errors %}<div class="error">{{ form.longitude.errors }}</div>{% endif %}
                    </div>
                </div>
            </div>

            <!-- Características del incidente -->
            <div class="form-section">
                <h3>Características</h3>
                <div class="form-row">
                    <div class="form-group">
                        <div class="form-check">
                            {{ form.is_emergency }}
                            {{ form.is_emergency.label_tag }}
                            {% if form.is_emergency.errors %}<div class="error">{{ form.is_emergency.errors }}</div>{% endif %}
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-check">
                            {{ form.requires_tow }}
                            {{ form.requires_tow.label_tag }}
                            {% if form.requires_tow.errors %}<div class="error">{{ form.requires_tow.errors }}</div>{% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sección de imágenes -->
            <div class="form-group">
                <label>Imágenes del incidente (opcional):</label>

                <!-- Contenedor de cámara -->
                <div class="camera-container">
                    <video id="camera-preview" class="camera-preview" autoplay playsinline></video>
                    <canvas id="camera-canvas" style="display: none;"></canvas>

                    <div class="camera-controls">
                        <button type="button" id="start-camera" class="btn-camera">
                            <i class="fas fa-camera"></i> Activar Cámara
                        </button>
                        <button type="button" id="capture-photo" class="btn-capture" style="display: none;">
                            <i class="fas fa-camera-retro"></i> Tomar Foto
                        </button>
                        <button type="button" id="stop-camera" class="btn-camera" style="display: none;">
                            <i class="fas fa-stop"></i> Detener Cámara
                        </button>
                    </div>

                    <div class="captured-images" id="captured-images"></div>
                </div>

                <!-- Campo oculto para las imágenes capturadas -->
                <input type="file" name="camera_images" id="camera-images-input" multiple style="display: none;" accept="image/*">

                <small class="form-text text-muted">
                    Use la cámara para tomar fotos del incidente. Las imágenes se subirán automáticamente.
                </small>
            </div>

            <div class="botones">
                <button type="submit" class="btn-programar">Reportar</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}