{% extends 'base.html' %}
{% load static %}

{% block title %}Detalle de Ingreso{% endblock %}

{% block static %}
<link rel="stylesheet" href="{% static 'agenda/css/formulario.css' %}">
<link rel="stylesheet" href="{% static 'agenda/css/ingreso_detail.css' %}">
{% endblock %}

{% block content %}
<div class="contenedor">
  <div class="formulario">
    <h2>Detalle de Ingreso</h2>

    <div class="detail-container">
      <div class="detail-field">
        <strong>ID:</strong> {{ ingreso.id_ingreso }}
      </div>
      <div class="detail-field">
        <strong>Patente:</strong> {{ ingreso.patent }}
      </div>
      <div class="detail-field">
        <strong>Servicio:</strong> {{ ingreso.service_type|default:"Sin especificar" }}
      </div>
      <div class="detail-field">
        <strong>Entrada:</strong> {{ ingreso.entry_datetime }}
      </div>
      <div class="detail-field">
        <strong>Salida:</strong> {{ ingreso.exit_datetime|default:"Pendiente" }}
      </div>
      <div class="detail-field">
        <strong>Chofer:</strong> {{ ingreso.chofer }}
      </div>
      <div class="detail-field">
        <strong>Supervisor:</strong> {{ ingreso.supervisor|default:"-" }}
      </div>
      <div class="detail-field">
        <strong>Observaciones:</strong> {{ ingreso.observations|default:"-" }}
      </div>
      <div class="detail-field">
        <strong>Sucursal de Origen:</strong> {{ ingreso.patent.site.name }}
      </div>
      <div class="detail-field">
        <strong>Ruta:</strong> {% for route in ingreso.patent.route_set.all %}{{ route.route_code }}{% if not forloop.last %}, {% endif %}{% endfor %}
      </div>
      <div class="detail-field">
        <strong>Autorización:</strong>
        {% if ingreso.authorization %}
          <span class="authorization-yes">Sí</span>
        {% else %}
          <span class="authorization-no">No</span>
        {% endif %}
      </div>
      <div class="detail-field">
        <strong>Salida Registrada Por:</strong> {{ ingreso.exit_registered_by|default:"-" }}
      </div>
      <div class="detail-field">
        <strong>Entrada Registrada Por:</strong> {{ ingreso.entry_registered_by|default:"-" }}
      </div>
      {% if ingreso.schedule %}
      <div class="detail-field">
        <strong>Agendamiento Relacionado:</strong>
        <span class="related-badge">ID {{ ingreso.schedule.id_schedule }}</span>
        <small class="related-time">Agendado: {{ ingreso.schedule.start_datetime|date:"d/m/Y H:i" }}</small>
      </div>
      {% endif %}
    </div>

    <h3 class="related-title">Agendamientos Relacionados</h3>
    {% if schedules %}
    <div class="related-schedules">
      {% for schedule in schedules %}
      <div class="schedule-item">
        {{ schedule.start_datetime }} - {{ schedule.end_datetime }}: {{ schedule.observations }}
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="no-related">
      No hay agendamientos relacionados
    </div>
    {% endif %}

    <div class="back-section">
      <a href="{% url 'ingresos_list' %}" class="btn-programar">Volver a Lista de Ingresos</a>
      <br> <br>
      <a href="{% url 'orden_trabajo_list' %}" class="btn-programar">Volver a Órdenes de Trabajo</a>
    </div>
  </div>
</div>
{% endblock %}