{% extends 'base.html' %}
{% load static %}

{% block title %}Detalle de Ingreso{% endblock %}

{% block content %}
<div class="container mt-4">
  <h1 class="mb-4">Detalle de Ingreso</h1>
  <div class="card">
    <div class="card-body">
      <p class="card-text"><strong>ID:</strong> {{ ingreso.id_ingreso }}</p>
      <p class="card-text"><strong>Patente:</strong> {{ ingreso.patent }}</p>
      <p class="card-text"><strong>Servicio:</strong> {{ ingreso.service_type }}</p>
      <p class="card-text"><strong>Entrada:</strong> {{ ingreso.entry_datetime }}</p>
      <p class="card-text"><strong>Salida:</strong> {{ ingreso.exit_datetime|default:"Pendiente" }}</p>
      <p class="card-text"><strong>Chofer:</strong> {{ ingreso.chofer }}</p>
      <p class="card-text"><strong>Supervisor:</strong> {{ ingreso.supervisor|default:"-" }}</p>
      <p class="card-text"><strong>Observaciones:</strong> {{ ingreso.observations|default:"-" }}</p>
      <p class="card-text"><strong>Sucursal de Origen:</strong> {{ ingreso.patent.site.name }}</p>
      <p class="card-text"><strong>Ruta:</strong> {% for route in ingreso.patent.route_set.all %}{{ route.route_code }}{% if not forloop.last %}, {% endif %}{% endfor %}</p>
      <p class="card-text"><strong>Autorización:</strong> 
        {% if ingreso.authorization %}
          <span class="badge bg-success">Sí</span>
        {% else %}
          <span class="badge bg-danger">No</span>
        {% endif %}
      </p>
      <p class="card-text"><strong>Salida Registrada Por:</strong> {{ ingreso.exit_registered_by|default:"-" }}</p>
      <p class="card-text"><strong>Entrada Registrada Por:</strong> {{ ingreso.entry_registered_by|default:"-" }}</p>
      {% if ingreso.schedule %}
      <p class="card-text"><strong>Agendamiento Relacionado:</strong> 
        <span class="badge bg-info">ID {{ ingreso.schedule.id_schedule }}</span>
        <small class="text-muted">Agendado: {{ ingreso.schedule.start_datetime|date:"d/m/Y H:i" }}</small>
      </p>
      {% endif %}
    </div>
  </div>

  <h2 class="mt-4">Agendamientos Relacionados</h2>
  <ul class="list-group">
    {% for schedule in schedules %}
    <li class="list-group-item">{{ schedule.start_datetime }} - {{ schedule.end_datetime }}: {{ schedule.observations }}</li>
    {% endfor %}
  </ul>

  <a href="{% url 'ingresos_list' %}" class="btn btn-secondary mt-3">Volver a Lista</a>
</div>
{% endblock %}