{% extends 'base.html' %}
{% load static %}
{% block title %}Reportes de Reportes{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
        <div class="d-flex align-items-center mb-3 mb-md-0">
          <a href="{% url 'document_upload:dashboard' %}" class="btn btn-outline-secondary me-3">
            <i class="fas fa-arrow-left"></i> Volver al Dashboard
          </a>
          <h1 class="mb-0">
            <i class="fas fa-file-excel"></i> Reportes de Reportes
          </h1>
        </div>
      </div>
    </div>
  </div>

  <!-- Información general -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="alert alert-info">
        <i class="fas fa-info-circle"></i>
        <strong>Información:</strong> Selecciona el tipo de reporte de reportes que deseas generar. Los reportes se descargarán automáticamente en formato Excel (.xlsx).
      </div>
    </div>
  </div>

  <!-- Reportes de Reportes -->
  <div class="row mb-5">
    <div class="col-12">
      <h3 class="mb-3">
        <i class="fas fa-chart-line text-primary"></i> Tipos de Reportes Disponibles
      </h3>
      <div class="row">
        {% for report in report_types %}
          {% if report.id|slice:":8" == "reportes" %}
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card h-100 border-{{ report.color }}">
                <div class="card-header bg-{{ report.color }} text-white">
                  <h5 class="card-title mb-0">
                    <i class="{{ report.icon }}"></i> {{ report.name }}
                  </h5>
                </div>
                <div class="card-body">
                  <p class="card-text">{{ report.description }}</p>
                </div>
                <div class="card-footer">
                  <a href="{% url 'document_upload:generate_excel_report' report.id %}" class="btn btn-{{ report.color }} w-100">
                    <i class="fas fa-download"></i> Generar Excel
                  </a>
                </div>
              </div>
            </div>
          {% elif report.id == "productividad" %}
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card h-100 border-{{ report.color }}">
                <div class="card-header bg-{{ report.color }} text-white">
                  <h5 class="card-title mb-0">
                    <i class="{{ report.icon }}"></i> {{ report.name }}
                  </h5>
                </div>
                <div class="card-body">
                  <p class="card-text">{{ report.description }}</p>
                  <div class="mt-3">
                    <label for="periodo-productividad" class="form-label small">Seleccionar período:</label>
                    <select class="form-select form-select-sm" id="periodo-productividad">
                      <option value="diario">Diario</option>
                      <option value="semanal">Semanal</option>
                      <option value="mensual">Mensual</option>
                    </select>
                  </div>
                  <div class="mt-2">
                    <small class="text-muted">
                      <i class="fas fa-info-circle"></i> Incluye KPIs de productividad, gráficos de barras y análisis por zona/mecánico.
                    </small>
                  </div>
                </div>
                <div class="card-footer">
                  <button type="button" class="btn btn-{{ report.color }} w-100" onclick="generarProductividad()">
                    <i class="fas fa-download"></i> Generar Excel
                  </button>
                </div>
              </div>
            </div>
          {% elif report.id == "tiempos_horas_hombre" %}
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card h-100 border-{{ report.color }}">
                <div class="card-header bg-{{ report.color }} text-white">
                  <h5 class="card-title mb-0">
                    <i class="{{ report.icon }}"></i> {{ report.name }}
                  </h5>
                </div>
                <div class="card-body">
                  <p class="card-text">{{ report.description }}</p>
                  <div class="mt-3">
                    <div class="row">
                      <div class="col-6">
                        <label for="periodo-tiempos" class="form-label small">Período:</label>
                        <select class="form-select form-select-sm" id="periodo-tiempos">
                          <option value="semanal">Semanal</option>
                          <option value="mensual">Mensual</option>
                        </select>
                      </div>
                      <div class="col-6">
                        <label for="filtro-tiempos" class="form-label small">Filtrar por:</label>
                        <select class="form-select form-select-sm" id="filtro-tiempos">
                          <option value="todos">Todos</option>
                          <option value="zona">Por Zona</option>
                          <option value="mecanico">Por Mecánico</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="mt-2">
                    <small class="text-muted">
                      <i class="fas fa-info-circle"></i> Incluye análisis de tiempos, gráfico de pastel de pausas y colores condicionales.
                    </small>
                  </div>
                </div>
                <div class="card-footer">
                  <button type="button" class="btn btn-{{ report.color }} w-100" onclick="generarTiemposHorasHombre()">
                    <i class="fas fa-download"></i> Generar Excel
                  </button>
                </div>
              </div>
            </div>
          {% elif report.id == "vehiculos_ingresados_salidos" %}
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card h-100 border-{{ report.color }}">
                <div class="card-header bg-{{ report.color }} text-white">
                  <h5 class="card-title mb-0">
                    <i class="{{ report.icon }}"></i> {{ report.name }}
                  </h5>
                </div>
                <div class="card-body">
                  <p class="card-text">{{ report.description }}</p>
                  <div class="mt-3">
                    <div class="row">
                      <div class="col-6">
                        <label for="periodo-vehiculos" class="form-label small">Período:</label>
                        <select class="form-select form-select-sm" id="periodo-vehiculos">
                          <option value="diario">Diario</option>
                          <option value="semanal">Semanal</option>
                          <option value="mensual">Mensual</option>
                        </select>
                      </div>
                      <div class="col-6">
                        <label for="filtro-vehiculos" class="form-label small">Filtrar por:</label>
                        <select class="form-select form-select-sm" id="filtro-vehiculos">
                          <option value="todos">Todos</option>
                          <option value="zona">Por Zona</option>
                          <option value="sucursal">Por Sucursal</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="mt-2">
                    <small class="text-muted">
                      <i class="fas fa-info-circle"></i> Incluye tiempos en taller, estados de vehículos y mapa simple.
                    </small>
                  </div>
                </div>
                <div class="card-footer">
                  <button type="button" class="btn btn-{{ report.color }} w-100" onclick="generarVehiculosIngresadosSalidos()">
                    <i class="fas fa-download"></i> Generar Excel
                  </button>
                </div>
              </div>
            </div>
          {% comment %} {% elif report.id == "repuestos_utilizados" %}
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card h-100 border-{{ report.color }}">
                <div class="card-header bg-{{ report.color }} text-white">
                  <h5 class="card-title mb-0">
                    <i class="{{ report.icon }}"></i> {{ report.name }}
                  </h5>
                </div>
                <div class="card-body">
                  <p class="card-text">{{ report.description }}</p>
                  <div class="mt-3">
                    <div class="row">
                      <div class="col-6">
                        <label for="periodo-repuestos" class="form-label small">Período:</label>
                        <select class="form-select form-select-sm" id="periodo-repuestos">
                          <option value="semanal">Semanal</option>
                          <option value="mensual">Mensual</option>
                        </select>
                      </div>
                      <div class="col-6">
                        <label for="filtro-repuestos" class="form-label small">Filtrar por:</label>
                        <select class="form-select form-select-sm" id="filtro-repuestos">
                          <option value="todos">Todos</option>
                          <option value="zona">Por Zona</option>
                          <option value="proveedor">Por Proveedor</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="mt-2">
                    <small class="text-muted">
                      <i class="fas fa-info-circle"></i> Incluye análisis de repuestos utilizados y mapa simple de zonas.
                    </small>
                  </div>
                </div>
                <div class="card-footer">
                  <button type="button" class="btn btn-{{ report.color }} w-100" onclick="generarRepuestosUtilizados()">
                    <i class="fas fa-download"></i> Generar Excel
                  </button>
                </div>
              </div>
            </div> {% endcomment %}
          {% elif report.id == "kpis_flota" %}
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card h-100 border-{{ report.color }}">
                <div class="card-header bg-{{ report.color }} text-white">
                  <h5 class="card-title mb-0">
                    <i class="{{ report.icon }}"></i> {{ report.name }}
                  </h5>
                </div>
                <div class="card-body">
                  <p class="card-text">{{ report.description }}</p>
                  <div class="mt-3">
                    <label for="periodo-kpis" class="form-label small">Seleccionar período:</label>
                    <select class="form-select form-select-sm" id="periodo-kpis">
                      <option value="mensual">Mensual</option>
                    </select>
                  </div>
                  <div class="mt-2">
                    <small class="text-muted">
                      <i class="fas fa-info-circle"></i> Incluye dashboard con gauges, comparativos vs período anterior, y exportación a Power BI.
                    </small>
                  </div>
                </div>
                <div class="card-footer">
                  <button type="button" class="btn btn-{{ report.color }} w-100" onclick="generarKPIsFlota()">
                    <i class="fas fa-download"></i> Generar Excel
                  </button>
                </div>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Información técnica -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-cogs"></i> Información Técnica
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <h6>Formatos de Reporte:</h6>
              <ul>
                <li><strong>Excel (.xlsx):</strong> Compatible con Microsoft Excel, Google Sheets, LibreOffice</li>
                <li><strong>Datos de reportes:</strong> Los reportes incluyen estadísticas e información detallada sobre los reportes del sistema</li>
                <li><strong>Reporte de Productividad:</strong> Análisis completo de mantenimientos con KPIs, incluye múltiples hojas (BaseOTs, KPIs, Gráficos)</li>
                <li><strong>Reporte de Tiempos y Horas Hombre:</strong> Análisis detallado de tiempos de trabajo, pausas y eficiencia, incluye gráfico de pastel y colores condicionales</li>
                <li><strong>Reporte de Repuestos Utilizados:</strong> Análisis de consumo de repuestos con costos, proveedores y alertas de stock, incluye tabla pivot y gráficos</li>
                <li><strong>Reporte de Vehículos I/O:</strong> Control de ingresos y salidas con tiempos, estados y mapa simple</li>
              </ul>
            </div>
            <div class="col-md-6">
              <h6>Requisitos:</h6>
              <ul>
                <li><strong>Librería openpyxl:</strong> Necesaria para generar archivos Excel</li>
                <li><code>pip install openpyxl</code></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% block extra_js %}
<script src="{% static 'document_upload/js/reports_dashboard.js' %}"></script>
{% endblock %}
{% endblock %}