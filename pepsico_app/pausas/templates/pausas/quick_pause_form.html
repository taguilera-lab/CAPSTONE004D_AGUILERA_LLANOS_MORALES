{% extends 'base.html' %}
{% load static %}

{% block title %}Pausa Rápida{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-lg-6">
      <div class="card">
        <div class="card-header bg-warning text-white">
          <h4 class="mb-0">
            <i class="fas fa-bolt"></i> Pausa Rápida
          </h4>
        </div>
        <div class="card-body">
          <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            <strong>Modo Rápido:</strong> Registre una pausa con información mínima.
            Para pausas detalladas, use el formulario completo.
          </div>

          <form method="post" id="quick-pause-form">
            {% csrf_token %}
            {% for hidden in form.hidden_fields %}
              {{ hidden }}
            {% endfor %}

            <!-- Selección de Orden de Trabajo -->
            <div class="mb-3">
              <label for="{{ form.work_order.id_for_label }}" class="form-label">
                Orden de Trabajo <span class="text-danger">*</span>
              </label>
              {{ form.work_order }}
              {% if form.work_order.errors %}
                <div class="text-danger">{{ form.work_order.errors.0 }}</div>
              {% endif %}
            </div>

            <!-- Tipo de Pausa -->
            <div class="mb-3">
              <label for="{{ form.pause_type.id_for_label }}" class="form-label">
                Tipo de Pausa <span class="text-danger">*</span>
              </label>
              {{ form.pause_type }}
              {% if form.pause_type.errors %}
                <div class="text-danger">{{ form.pause_type.errors.0 }}</div>
              {% endif %}
            </div>

            <!-- Motivo Rápido -->
            <div class="mb-3">
              <label for="{{ form.reason.id_for_label }}" class="form-label">
                Motivo <span class="text-danger">*</span>
              </label>
              {{ form.reason }}
              {% if form.reason.errors %}
                <div class="text-danger">{{ form.reason.errors.0 }}</div>
              {% endif %}
              <div class="form-text">Breve descripción del motivo</div>
            </div>

            <!-- Mecánico (opcional) -->
            <div class="mb-3">
              <label for="{{ form.mechanic_assignment.id_for_label }}" class="form-label">
                Mecánico (Opcional)
              </label>
              {{ form.mechanic_assignment }}
              {% if form.mechanic_assignment.errors %}
                <div class="text-danger">{{ form.mechanic_assignment.errors.0 }}</div>
              {% endif %}
              <div class="form-text">Deje vacío para pausa general en la OT</div>
            </div>

            <!-- Repuesto (solo para stock) -->
            <div class="mb-3" id="spare-part-field" style="display: none;">
              <label for="{{ form.affected_spare_part.id_for_label }}" class="form-label">
                Repuesto Faltante
              </label>
              {{ form.affected_spare_part }}
              {% if form.affected_spare_part.errors %}
                <div class="text-danger">{{ form.affected_spare_part.errors.0 }}</div>
              {% endif %}
            </div>

            <!-- Botones -->
            <div class="d-flex justify-content-between">
              <a href="{% url 'pausas:dashboard' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Cancelar
              </a>
              <button type="submit" class="btn btn-warning">
                <i class="fas fa-save"></i> Crear Pausa Rápida
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Atajos Rápidos -->
      <div class="card mt-3">
        <div class="card-header">
          <h5 class="mb-0">Atajos Rápidos</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-6 mb-2">
              <button class="btn btn-outline-primary btn-sm w-100 quick-reason" data-reason="Falta de repuestos">
                <i class="fas fa-cogs"></i> Falta Repuestos
              </button>
            </div>
            <div class="col-6 mb-2">
              <button class="btn btn-outline-success btn-sm w-100 quick-reason" data-reason="Descanso del mecánico">
                <i class="fas fa-coffee"></i> Descanso
              </button>
            </div>
            <div class="col-6 mb-2">
              <button class="btn btn-outline-warning btn-sm w-100 quick-reason" data-reason="Problema técnico">
                <i class="fas fa-wrench"></i> Problema Técnico
              </button>
            </div>
            <div class="col-6 mb-2">
              <button class="btn btn-outline-info btn-sm w-100 quick-reason" data-reason="Espera de instrucciones">
                <i class="fas fa-clock"></i> Espera Instrucciones
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% block extra_css %}
<style>
.autocomplete-inline {
  font-family: inherit;
  font-size: inherit;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: calc(100% - 24px);
}

.autocomplete-item strong {
  background-color: #fff3cd;
  padding: 2px 4px;
  border-radius: 3px;
}

.autocomplete-suggestions {
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  border-top: none;
  margin-top: -1px;
}

.autocomplete-item:hover {
  background-color: #f8f9fa !important;
}
</style>
{% endblock %}

{% block extra_js %}
<script src="{% static 'pausas/js/quick_pause.js' %}"></script>
{% endblock %}
{% endblock %}